(()=>{"use strict";var e={92:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.writeContent=t.readContent=t.getDownloadFileInfosOfTranslationFile=t.getUploadFileInfosOfTranslationFile=void 0;const r=i(o(410)),n=i(o(928)),a=i(o(652)),l=o(616),s=e=>{const t=e.directory??"",o=`${e.filename}.${e.extension}`,i=n.default.join(l.CURRENT_WORK_DIR,t,o);return[i,c(i,"*")]},c=(e,t)=>{const o="*"===t?"*":(e=>e.replace("_","-").split("-",2)[0])(t);return e.replace("%language",o).replace("%locale",t)};t.getUploadFileInfosOfTranslationFile=e=>{const[t,o]=s(e),i=r.default.sync(o),n=[];return i.forEach(o=>{const i=((e,t,o)=>o.find(o=>e===c(t,o)))(o,t,e.locales);i&&n.push({path:o,locale:i})}),n},t.getDownloadFileInfosOfTranslationFile=e=>{const[t]=s(e),o=[];return e.locales.forEach(e=>{const i=c(t,e);o.push({path:i,locale:e})}),o},t.readContent=e=>a.default.readFileSync(e,"utf8"),t.writeContent=(e,t)=>(a.default.ensureFileSync(e),a.default.writeFileSync(e,t))},156:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(186);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i(r).default}})},186:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(938)),n=i(o(652)),a=i(o(937)),l=i(o(928)),s=i(o(314)),c=o(547),u=o(616),f=o(729),d=o(820),p=o(227),_=e=>{switch(e){case"init":return f.Action.INIT;case"upload":return f.Action.UPLOAD;case"download":return f.Action.DOWNLOAD;default:return f.Action.NONE}};t.default=async e=>{let t=await(async e=>{const t=await(0,s.default)((0,c.hideBin)(e)).epilogue("for more information, find our website at https://i18nature.com").usage("Command-line tool of I18Nature localization tool.\n\nUsage: $0 <cmd> [args]").command("init [project_api_key]","Create .i18naturerc.json file.",e=>e.positional("project_api_key",{describe:"project to bind on",default:u.DEFAULT_API_KEY}),e=>{e.verbose&&console.info(`create config file of: ${e.project_api_key}`)}).command("upload","Upload translation files.",e=>e,e=>{e.verbose&&console.info("upload translation file")}).command("download","Download translation files.",e=>e,e=>{e.verbose&&console.info("download translation file")}).options({help:{type:"boolean",alias:"h",description:"Show help",global:!1},verbose:{type:"boolean",alias:"v",description:"Run with verbose logging",global:!0},yes:{type:"boolean",alias:"y",description:"Skip prompts",global:!0},debug:{type:"boolean",description:"Debug mode",global:!0},overwriteTranslations:{type:"boolean",description:"Overwrite translation files on upload",global:!0}}).argv,o=t.debug?u.DEBUG_FILENAME:u.FILENAME,i=l.default.join(u.CURRENT_WORK_DIR,o);return{projectApiKey:t.project_api_key,skipPrompts:t.yes??!1,verbose:t.verbose??!1,debug:t.debug??!1,overwriteConfigFile:t.yes??!1,overwriteTranslations:t.overwriteTranslations??!1,configFileName:o,configFilePath:i,directory:"",existsProjectConfigFile:n.default.existsSync(i),action:_(t._[0])}})(e);t=await(async e=>{if(e.skipPrompts)return e;const t=[],o=e.projectApiKey===u.DEFAULT_API_KEY;if(e.action===f.Action.INIT&&e.existsProjectConfigFile&&t.push({type:"confirm",name:"overwriteConfigFile",message:`Overwrite existing ${e.configFileName} file?`,default:!1}),e.action===f.Action.INIT){let i={project_api_key:e.projectApiKey};e.existsProjectConfigFile&&(i=JSON.parse(n.default.readFileSync(e.configFilePath,"utf8"))),t.push({type:"input",name:"projectApiKey",message:"Project API key?",default:i.project_api_key,when:e=>e.overwriteConfigFile||o}),t.push({type:"input",name:"directory",message:"Relative path of translation files directory?",default:"i18n/locales",when:t=>t.overwriteConfigFile||!e.existsProjectConfigFile})}const i=await a.default.prompt(t);return{...e,projectApiKey:e.projectApiKey!==u.DEFAULT_API_KEY?e.projectApiKey:i.projectApiKey,overwriteConfigFile:i.overwriteConfigFile||!e.existsProjectConfigFile,directory:e.directory||i.directory}})(t);const o=(e=>{switch(r.default.defaults.baseURL=e.debug?u.DEBUG_BASE_URL:u.BASE_URL,e.action){case f.Action.INIT:return(0,d.init)(e);case f.Action.UPLOAD:return(0,d.upload)(e);case f.Action.DOWNLOAD:return(0,d.download)(e);default:return[]}})(t);return(0,p.runTasks)(o)}},227:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.runTasks=t.getDownloadTasksFromTranslationFiles=t.getUploadTasksFromTranslationFiles=void 0;const r=i(o(590)),n=o(92);t.getUploadTasksFromTranslationFiles=(e,t)=>a({title:"Upload translation file",subtitle:"Upload data of",translationFiles:e,fileInfoCallback:n.getUploadFileInfosOfTranslationFile,taskCallback:t}),t.getDownloadTasksFromTranslationFiles=(e,t)=>a({title:"Download translation file",subtitle:"Download data of",translationFiles:e,fileInfoCallback:n.getDownloadFileInfosOfTranslationFile,taskCallback:t});const a=e=>{const t=[];return e.translationFiles.forEach(async o=>{t.push({title:`${e.title}: ${o.name}`,task:async()=>{const t=[];return e.fileInfoCallback(o).forEach(i=>{t.push({title:`${e.subtitle}: ${i.path}`,task:async()=>{await e.taskCallback(o,i)}})}),new r.default(t)}})}),t};t.runTasks=async e=>new r.default(e).run().catch(e=>{console.error(e)})},314:e=>{e.exports=require("yargs")},328:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(938)),n=o(583),a=o(394);t.default=e=>((0,a.logHeader)("INIT"),e.overwriteConfigFile?[{title:`Create config file: ${e.configFilePath}`,task:async()=>{try{const{data:t}=await r.default.get("/api/projects/init",{params:{api_key:e.projectApiKey}}),o=t.translation_files.map(t=>({...t,directory:e.directory})),i=(0,n.createProjectConfig)(e.projectApiKey,o);(0,n.saveProjectConfig)(e.configFilePath,i)}catch(e){return Promise.reject(e)}}}]:(0,n.overwriteNotAllowedProjectConfigFile)(e))},338:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(938)),n=o(583),a=o(394),l=o(227),s=o(92);t.default=e=>{if((0,a.logHeader)("DOWNLOAD"),!e.existsProjectConfigFile)return(0,n.missingProjectConfigFile)(e);const t=(0,n.getProjectConfig)(e.configFilePath);return(0,l.getDownloadTasksFromTranslationFiles)(t.translation_files,async(e,o)=>{try{const{data:i}=await r.default.get(`/api/translation-files/${e.id??null}/download`,{params:{locale:o.locale,api_key:t.project_api_key}});(0,s.writeContent)(o.path,i.content)}catch(e){return Promise.reject(e)}})}},394:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logError=t.logHeader=void 0;const r=i(o(895)),n=o(616);t.logHeader=e=>console.log(r.default.hex(n.GREEN_COLOR).bold(e)),t.logError=e=>console.error(r.default.red.bold(e))},410:e=>{e.exports=require("glob")},547:e=>{e.exports=require("yargs/helpers")},579:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(938)),n=o(583),a=o(394),l=o(227),s=o(92);t.default=e=>{if((0,a.logHeader)("UPLOAD"),!e.existsProjectConfigFile)return(0,n.missingProjectConfigFile)(e);const t=(0,n.getProjectConfig)(e.configFilePath),o=(0,l.getUploadTasksFromTranslationFiles)(t.translation_files,async(o,i)=>{try{const{data:n}=await r.default.post(`/api/translation-files/${o.id??null}/upload`,{translation_file:o,content:(0,s.readContent)(i.path)},{params:{overwrite:e.overwriteTranslations,locale:i.locale,api_key:t.project_api_key}});o.id=n.translation_file_id}catch(e){return Promise.reject(e)}});return o.push({title:`Modified config file: ${e.configFilePath}`,task:()=>{(0,n.saveProjectConfig)(e.configFilePath,t)}}),o}},583:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.overwriteNotAllowedProjectConfigFile=t.missingProjectConfigFile=t.saveProjectConfig=t.getProjectConfig=t.createProjectConfig=void 0;const i=o(616),r=o(92);t.createProjectConfig=(e,t,o=1)=>({version:o,project_api_key:e,translation_files:t}),t.getProjectConfig=e=>{const t=(0,r.readContent)(e);return JSON.parse(t)},t.saveProjectConfig=(e,t)=>(0,r.writeContent)(e,JSON.stringify(t,null,i.INDENT)),t.missingProjectConfigFile=e=>[{title:`Missing config file: ${e.configFilePath}`,task:()=>Promise.reject(new Error("Create config file or init project!"))}],t.overwriteNotAllowedProjectConfigFile=e=>[{title:`Create config file: ${e.configFilePath}`,task:()=>Promise.reject(new Error("Config file overwrite is not allowed!"))}]},590:e=>{e.exports=require("listr")},616:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.INDENT=t.GREEN_COLOR=t.BASE_URL=t.DEBUG_BASE_URL=t.CURRENT_WORK_DIR=t.DEBUG_FILENAME=t.FILENAME=t.DEFAULT_API_KEY=void 0;const r=i(o(938));t.DEFAULT_API_KEY="API_KEY",t.FILENAME=".i18naturerc.json",t.DEBUG_FILENAME=".i18naturerc-debug.json",t.CURRENT_WORK_DIR=process.cwd(),t.DEBUG_BASE_URL="http://0.0.0.0:80",t.BASE_URL="https://app.i18nature.com",t.GREEN_COLOR="#0A4414",t.INDENT=2,r.default.interceptors.response.use(e=>e,e=>{const t=e.response?.data?.message??e.message;return Promise.reject(new Error(t))})},652:e=>{e.exports=require("fs-extra")},729:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Action=void 0,function(e){e[e.NONE=0]="NONE",e[e.INIT=1]="INIT",e[e.UPLOAD=2]="UPLOAD",e[e.DOWNLOAD=3]="DOWNLOAD"}(o||(t.Action=o={}))},820:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.upload=t.init=t.download=void 0;var r=o(338);Object.defineProperty(t,"download",{enumerable:!0,get:function(){return i(r).default}});var n=o(328);Object.defineProperty(t,"init",{enumerable:!0,get:function(){return i(n).default}});var a=o(579);Object.defineProperty(t,"upload",{enumerable:!0,get:function(){return i(a).default}})},895:e=>{e.exports=require("chalk")},928:e=>{e.exports=require("path")},937:e=>{e.exports=require("inquirer")},938:e=>{e.exports=require("axios")}},t={},o=function o(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,o),n.exports}(156);exports.default=o.default})();
//# sourceMappingURL=index.js.map